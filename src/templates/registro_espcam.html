<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro via ESP32-CAM</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/app.css') }}" />
</head>
<body data-page="registro" data-source="espcam">
  <header class="header"><div class="title">Registro de Rostos — Fonte ESP32-CAM</div></header>
  <main class="container">
    <div id="overlay-training" class="overlay-training hidden" aria-hidden="true">
      <h3>Atualizando modelo de reconhecimento</h3>
      <div class="progress-track"><div class="progress-bar"></div></div>
      <div class="training-msg" id="training-text">Isso pode levar alguns segundos dependendo da quantidade de imagens...</div>
      <button type="button" class="btn secondary" id="btn-cancel-train" style="margin-top:22px; display:none;" disabled>Cancelar</button>
    </div>
    <div class="step-indicator" id="etapa">Etapa 1 de 2 — Dados do voluntário</div>
    <div class="grid">
      <section class="panel" id="form-panel">
        <h2>Dados do Voluntário</h2>
        <form id="form-cadastro" autocomplete="off">
          <div class="group"><label for="nome-pessoa">Nome completo *</label><input id="nome-pessoa" required placeholder="Fulano de Tal" /></div>
          <div class="group"><label for="cpf-pessoa">CPF *</label><input id="cpf-pessoa" required maxlength="14" placeholder="000.000.000-00" /></div>
          <div class="group"><label for="matricula-pessoa">Matrícula *</label><input id="matricula-pessoa" required placeholder="Identificador interno" /></div>
          <div class="group"><label for="email-pessoa">Email (opcional)</label><input id="email-pessoa" type="email" placeholder="email@exemplo.com" /></div>
        </form>
        <div class="actions">
          <button class="btn" id="btn-verificar" type="button">Verificar / Continuar</button>
          <button class="btn secondary" id="btn-reset" type="button" style="display:none;">Novo cadastro</button>
        </div>
        <div id="status-messages"></div>
        <div class="url-box">Stream: {{ stream_url }}</div>
      </section>
      <section class="panel" id="capture-panel" style="display:none;">
        <h2>Stream ESP32-CAM</h2>
        <div class="video-wrap">
          <img src="{{ stream_url }}" alt="Stream ESP32-CAM" id="espcam-stream" />
          <canvas id="overlay"></canvas>
        </div>
        <div class="instructions">
          <ul>
            <li>Mantenha o rosto centralizado e bem iluminado.</li>
            <li>Varie levemente ângulo e expressão para múltiplas fotos.</li>
            <li>Recomendado: 10–15 fotos.</li>
            <li>Processamento via snapshot para habilitar captura.</li>
          </ul>
        </div>
        <div class="actions">
          <button class="btn" id="btn-capturar" type="button" disabled>Capturar Foto</button>
          <button class="btn secondary" id="btn-finalizar" type="button" disabled>Finalizar</button>
        </div>
        <div class="capture-count" id="capture-counter">Nenhuma foto capturada ainda.</div>
        <div class="hint" id="frame-hint" style="font-size:11px; color:#666; margin-top:6px;">Aguardando primeiro frame processado...</div>
      </section>
    </div>
    <section class="panel" style="margin-top:24px;">
      <h2>Registros Existentes</h2>
      <div id="pessoas-lista" class="list-reg">
        <div class="pessoa-item"><span>Carregando...</span></div>
      </div>
      <div style="margin-top:16px;" class="actions">
        <a href="{{ url_for('index_espcam') }}" class="btn secondary">Voltar para stream</a>
        <a href="{{ url_for('index') }}" class="btn secondary">Reconhecimento Local</a>
      </div>
    </section>
  </main>
  <footer class="footer"><div class="inner">Hospital do Cajuru — Registro via ESP32-CAM</div></footer>
  <script type="module" src="{{ url_for('static', filename='js/registro.js') }}"></script>
</body>
</html>
