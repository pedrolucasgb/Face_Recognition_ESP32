<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de C√¢mera</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        video { width: 100%; max-width: 640px; border: 2px solid #333; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
        .info { background: #f0f0f0; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        pre { background: #263238; color: #aed581; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üé• Teste de Acesso √† C√¢mera</h1>
    
    <div class="info">
        <strong>Objetivo:</strong> Verificar se seu navegador consegue acessar a c√¢mera corretamente.
    </div>

    <div id="status" class="info">
        Aguardando in√≠cio do teste...
    </div>

    <video id="video" autoplay playsinline></video>
    
    <div style="margin: 20px 0;">
        <button onclick="testCamera()">Testar C√¢mera</button>
        <button onclick="listDevices()">Listar Dispositivos</button>
        <button onclick="stopCamera()">Parar C√¢mera</button>
    </div>

    <div id="devices-info"></div>
    <div id="error-info"></div>

    <h3>Console de Debug:</h3>
    <pre id="console-output"></pre>

    <script>
        const video = document.getElementById('video');
        const statusDiv = document.getElementById('status');
        const devicesDiv = document.getElementById('devices-info');
        const errorDiv = document.getElementById('error-info');
        const consoleOutput = document.getElementById('console-output');
        let currentStream = null;

        function log(msg) {
            console.log(msg);
            consoleOutput.textContent += msg + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // Verifica suporte
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            statusDiv.className = 'info error';
            statusDiv.innerHTML = '<strong>ERRO:</strong> Seu navegador n√£o suporta acesso √† c√¢mera (getUserMedia n√£o dispon√≠vel)';
            log('‚ùå getUserMedia n√£o dispon√≠vel neste navegador');
        } else {
            log('‚úÖ getUserMedia est√° dispon√≠vel');
        }

        // Detecta tipo de dispositivo
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        log(`Dispositivo detectado: ${isMobile ? 'MOBILE' : 'DESKTOP'}`);
        log(`User Agent: ${navigator.userAgent}`);

        async function listDevices() {
            try {
                log('\nüîç Listando dispositivos...');
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(d => d.kind === 'videoinput');
                
                log(`Total de dispositivos: ${devices.length}`);
                log(`C√¢meras de v√≠deo: ${videoDevices.length}`);
                
                devicesDiv.className = 'info success';
                devicesDiv.innerHTML = '<h3>Dispositivos Encontrados:</h3>';
                
                if (videoDevices.length === 0) {
                    devicesDiv.innerHTML += '<p>‚ùå Nenhuma c√¢mera encontrada</p>';
                    log('‚ùå Nenhuma c√¢mera encontrada');
                } else {
                    videoDevices.forEach((device, index) => {
                        devicesDiv.innerHTML += `
                            <div style="padding: 10px; border-left: 3px solid #4caf50; margin: 5px 0;">
                                <strong>C√¢mera ${index + 1}</strong><br>
                                Label: ${device.label || 'Sem nome'}<br>
                                ID: ${device.deviceId}<br>
                                Group ID: ${device.groupId}
                            </div>
                        `;
                        log(`üìπ C√¢mera ${index + 1}: ${device.label || 'Sem nome'} (${device.deviceId})`);
                    });
                }
            } catch (err) {
                log(`‚ùå Erro ao listar dispositivos: ${err.name} - ${err.message}`);
                devicesDiv.className = 'info error';
                devicesDiv.innerHTML = `<strong>Erro:</strong> ${err.message}`;
            }
        }

        async function testCamera() {
            try {
                log('\nüé¨ Iniciando teste de c√¢mera...');
                statusDiv.className = 'info';
                statusDiv.innerHTML = '‚è≥ Solicitando acesso √† c√¢mera...';
                
                // Para stream anterior se existir
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }

                // Tenta primeiro com configura√ß√£o b√°sica
                log('Tentando: { video: true }');
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                
                currentStream = stream;
                video.srcObject = stream;
                await video.play();
                
                const track = stream.getVideoTracks()[0];
                const settings = track.getSettings();
                
                log('‚úÖ C√¢mera acessada com sucesso!');
                log(`Configura√ß√µes: ${JSON.stringify(settings, null, 2)}`);
                
                statusDiv.className = 'info success';
                statusDiv.innerHTML = `
                    <strong>‚úÖ C√¢mera funcionando!</strong><br>
                    Resolu√ß√£o: ${settings.width}x${settings.height}<br>
                    FPS: ${settings.frameRate || 'N/A'}<br>
                    Facing Mode: ${settings.facingMode || 'N/A'}<br>
                    Device ID: ${settings.deviceId || 'N/A'}
                `;
                
                errorDiv.innerHTML = '';
                
            } catch (err) {
                log(`‚ùå ERRO: ${err.name} - ${err.message}`);
                statusDiv.className = 'info error';
                statusDiv.innerHTML = `<strong>‚ùå Falha ao acessar c√¢mera</strong>`;
                
                errorDiv.className = 'info error';
                errorDiv.innerHTML = `
                    <h3>Detalhes do Erro:</h3>
                    <strong>Nome:</strong> ${err.name}<br>
                    <strong>Mensagem:</strong> ${err.message}<br>
                    <strong>Stack:</strong><br><pre>${err.stack || 'N/A'}</pre>
                `;
                
                // Dicas de solu√ß√£o
                if (err.name === 'NotAllowedError') {
                    errorDiv.innerHTML += '<p><strong>Solu√ß√£o:</strong> Voc√™ negou a permiss√£o. Clique no √≠cone de c√¢mera na barra de endere√ßo e permita o acesso.</p>';
                } else if (err.name === 'NotFoundError') {
                    errorDiv.innerHTML += '<p><strong>Solu√ß√£o:</strong> Nenhuma c√¢mera foi encontrada. Verifique se h√° uma c√¢mera conectada.</p>';
                } else if (err.name === 'NotReadableError') {
                    errorDiv.innerHTML += '<p><strong>Solu√ß√£o:</strong> A c√¢mera est√° sendo usada por outro aplicativo. Feche outros programas que possam estar usando a c√¢mera.</p>';
                } else if (err.name === 'SecurityError') {
                    errorDiv.innerHTML += '<p><strong>Solu√ß√£o:</strong> Acesso bloqueado por seguran√ßa. Use HTTPS ou localhost.</p>';
                }
            }
        }

        function stopCamera() {
            if (currentStream) {
                log('\n‚èπÔ∏è Parando c√¢mera...');
                currentStream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
                currentStream = null;
                statusDiv.className = 'info';
                statusDiv.innerHTML = 'C√¢mera parada.';
                log('‚úÖ C√¢mera parada');
            } else {
                log('‚ö†Ô∏è Nenhuma c√¢mera ativa para parar');
            }
        }

        // Auto-testa ao carregar
        window.addEventListener('load', () => {
            log('=== TESTE DE C√ÇMERA INICIADO ===\n');
            setTimeout(() => {
                listDevices();
            }, 500);
        });
    </script>
</body>
</html>
